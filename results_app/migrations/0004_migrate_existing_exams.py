# Generated by Django 5.2.8 on 2026-02-23 20:00

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('results_app', '0003_add_exam_model'),
    ]

def create_default_exams(apps, schema_editor):
    Institution = apps.get_model('results_app', 'Institution')
    Exam = apps.get_model('results_app', 'Exam')
    Result = apps.get_model('results_app', 'Result')

    for inst in Institution.objects.all():
        # Only create if there are results for this institution
        results_exist = Result.objects.filter(student__institution=inst).exists()
        if results_exist:
            default_exam, _ = Exam.objects.get_or_create(institution=inst, name="General Exam")
            Result.objects.filter(student__institution=inst, exam__isnull=True).update(exam=default_exam)

class Migration(migrations.Migration):

    dependencies = [
        ('results_app', '0003_add_exam_model'),
    ]

    operations = [
        migrations.RunPython(create_default_exams),
    ]
